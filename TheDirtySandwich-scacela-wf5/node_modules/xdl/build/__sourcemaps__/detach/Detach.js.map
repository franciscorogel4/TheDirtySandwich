{"version":3,"sources":["detach/Detach.js"],"names":["async","projectRoot","let","user","await","UserManager","ensureLoggedInAsync","Error","username","exp","ProjectUtils","readConfigJsonAsync","experienceName","slug","experienceUrl","hasIosDirectory","_isDirectory","path","join","hasAndroidDirectory","ErrorCode","DIRECTORY_ALREADY_EXISTS","process","platform","response","yesnoAsync","console","log","configName","configFilenameAsync","name","android","package","sdkVersion","versions","Versions","versionsAsync","sdkVersionConfig","sdkVersions","androidExpoViewUrl","iosExpoViewUrl","env","EXPO_VIEW_DIR","warn","isDetached","detach","scheme","detachedUUID","uuid","v4","replace","expoDirectory","mkdirp","sync","iosDirectory","rimraf","detachIOSAsync","androidDirectory","detachAndroidAsync","nameToWrite","expo","fs","promise","writeFile","JSON","stringify","detachAsync","searchPath","xcodeFilesToDelete","glob","ii","length","toRemove","existsSync","unlink","cleanXCodeProjectsAsync","versionsToDelete","cleanVersionedReactNativeAsync","configFilePath","detachedSDKVersion","kernelSDKVersion","modifyIOSPropertyListAsync","versionConfig","detachedNativeVersions","shell","kernel","configureDetachedVersionsPlistAsync","manifest","result","config","CFBundleURLTypes","CFBundleURLSchemes","push","UIDeviceFamily","configureDetachedIOSInfoPlistAsync","cleanIOSPropertyListBackupAsync","cleanPropertyListBackupsAsync","expoViewUrl","iosProjectDirectory","projectName","getIosPaths","tmpExpoDirectory","Api","downloadAsync","extract","Utils","ncpAsync","generatedExpoDir","closeSync","openSync","spawnAsyncThrowError","spawnAsync","infoPlistPath","iconPath","configureStandaloneIOSInfoPlistAsync","infoPlist","configureStandaloneIOSShellPlistAsync","configureIOSIconsAsync","podName","renderExponentViewPodspecAsync","IOS_EXPONENT_CLIENT_VERSION","EXClientVersion","renderPodfileAsync","TARGET_NAME","EXPONENT_ROOT_PATH","relative","REACT_NATIVE_PATH","rnFilesToDelete","i","podsInstructions","filename","regex","file","readFile","fileString","toString","regexFileAsync","directory","originalPkg","destPkg","originalSplitPackage","split","originalDeepDirectory","tmpDirectory","newSplitPackage","newDeepDirectory","renamePackageAsync","androidProjectDirectory","appBuildGradle","androidManifest","mainActivity","packageName","ANDROID_TEMPLATE_PKG","packageNameMatches","oldPkgRegex","RegExp","appName","resolve","ANDROID_TEMPLATE_NAME","icon","iconMatches","saveIconToPathAsync","projectDir","args","podsDirectory","rnPodDirectory","skipXcodeConfig","devUrl","UrlUtils","constructManifestUrlAsync","shellConfig","developmentUrl","expoBuildConstantsMatches","expoBuildConstants","prepareDetachedBuildAsync","ANDROID_TEMPLATE_COMPANY","dir","statSync","isDirectory","e","question","Promise","yesno","ask","ok","projectNameLabel","toLowerCase"],"mappings":"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","file":"../../detach/Detach.js","sourcesContent":["// Copyright 2015-present 650 Industries. All rights reserved.\n/**\n * @flow\n */\n\n'use strict';\n\n// Set EXPO_VIEW_DIR to universe/exponent to test locally\n\nimport 'instapromise';\n\nimport mkdirp from 'mkdirp';\nimport fs from 'fs';\nimport path from 'path';\nimport rimraf from 'rimraf';\nimport glob from 'glob';\nimport uuid from 'uuid';\nimport yesno from 'yesno';\n\nimport {\n  saveIconToPathAsync,\n  spawnAsyncThrowError,\n  spawnAsync,\n  modifyIOSPropertyListAsync,\n  cleanIOSPropertyListBackupAsync,\n  configureIOSIconsAsync,\n} from './ExponentTools';\nimport {\n  configureStandaloneIOSInfoPlistAsync,\n  configureStandaloneIOSShellPlistAsync,\n} from './IosShellApp';\nimport {\n  renderExponentViewPodspecAsync,\n  renderPodfileAsync,\n} from './IosPodsTools.js';\n\nimport Api from '../Api';\nimport ErrorCode from '../ErrorCode';\nimport * as ProjectUtils from '../project/ProjectUtils';\nimport UserManager from '../User';\nimport XDLError from '../XDLError';\nimport * as UrlUtils from '../UrlUtils';\nimport * as Utils from '../Utils';\nimport * as Versions from '../Versions';\n\nconst ANDROID_TEMPLATE_PKG = 'detach.app.template.pkg.name';\nconst ANDROID_TEMPLATE_COMPANY = 'detach.app.template.company.domain';\nconst ANDROID_TEMPLATE_NAME = 'DetachAppTemplate';\n\nfunction _isDirectory(dir) {\n  try {\n    if (fs.statSync(dir).isDirectory()) {\n      return true;\n    }\n\n    return false;\n  } catch (e) {\n    return false;\n  }\n}\n\nfunction yesnoAsync(question) {\n  return new Promise(resolve => {\n    yesno.ask(question, null, ok => {\n      resolve(ok);\n    });\n  });\n}\n\nexport async function detachAsync(projectRoot: string) {\n  let user = await UserManager.ensureLoggedInAsync();\n\n  if (!user) {\n    throw new Error(\n      'Internal error -- somehow detach is being run in offline mode.'\n    );\n  }\n\n  let username = user.username;\n  let { exp } = await ProjectUtils.readConfigJsonAsync(projectRoot);\n  let experienceName = `@${username}/${exp.slug}`;\n  let experienceUrl = `exp://exp.host/${experienceName}`;\n\n  // Check to make sure project isn't fully detached already\n  let hasIosDirectory = _isDirectory(path.join(projectRoot, 'ios'));\n  let hasAndroidDirectory = _isDirectory(path.join(projectRoot, 'android'));\n\n  if (hasIosDirectory && hasAndroidDirectory) {\n    throw new XDLError(\n      ErrorCode.DIRECTORY_ALREADY_EXISTS,\n      'Error detaching. `ios` and `android` directories already exist.'\n    );\n  }\n\n  // Project was already detached on Windows or Linux\n  if (\n    !hasIosDirectory && hasAndroidDirectory && process.platform === 'darwin'\n  ) {\n    let response = await yesnoAsync(\n      `This will add an Xcode project and leave your existing Android project alone. Enter 'yes' to continue:`\n    );\n    if (!response) {\n      console.log('Exiting...');\n      return false;\n    }\n  }\n\n  if (hasIosDirectory && !hasAndroidDirectory) {\n    throw new Error(\n      '`ios` directory already exists. Please remove it and try again.'\n    );\n  }\n\n  console.log('Validating project manifest...');\n  const configName = await ProjectUtils.configFilenameAsync(projectRoot);\n  if (!exp.name) {\n    throw new Error(`${configName} is missing \\`name\\``);\n  }\n\n  if (!exp.android || !exp.android.package) {\n    throw new Error(\n      `${configName} is missing android.package field. See https://docs.expo.io/versions/latest/guides/configuration.html#package`\n    );\n  }\n\n  if (!exp.sdkVersion) {\n    throw new Error(`${configName} is missing \\`sdkVersion\\``);\n  }\n  const versions = await Versions.versionsAsync();\n  let sdkVersionConfig = versions.sdkVersions[exp.sdkVersion];\n  if (\n    !sdkVersionConfig ||\n    !sdkVersionConfig.androidExpoViewUrl ||\n    !sdkVersionConfig.iosExpoViewUrl\n  ) {\n    if (process.env.EXPO_VIEW_DIR) {\n      console.warn(\n        `Detaching is not supported for SDK ${exp.sdkVersion}; ignoring this because you provided EXPO_VIEW_DIR`\n      );\n      sdkVersionConfig = {};\n    } else {\n      throw new Error(\n        `Detaching is not supported for SDK version ${exp.sdkVersion}`\n      );\n    }\n  }\n\n  if (process.platform !== 'darwin') {\n    let response = await yesnoAsync(\n      `Can't create an iOS project since you are not on macOS. You can rerun this command on macOS in the future to add an iOS project. Enter 'yes' to continue and just create an Android project:`\n    );\n    if (!response) {\n      console.log('Exiting...');\n      return false;\n    }\n  }\n\n  // Modify exp.json\n  exp.isDetached = true;\n\n  if (!exp.detach) {\n    exp.detach = {};\n  }\n\n  if (!exp.detach.scheme) {\n    let detachedUUID = uuid.v4().replace(/-/g, '');\n    exp.detach.scheme = `exp${detachedUUID}`;\n  }\n\n  let expoDirectory = path.join(projectRoot, '.expo-source');\n  mkdirp.sync(expoDirectory);\n\n  // iOS\n  if (process.platform === 'darwin' && !hasIosDirectory) {\n    let iosDirectory = path.join(expoDirectory, 'ios');\n    rimraf.sync(iosDirectory);\n    mkdirp.sync(iosDirectory);\n    await detachIOSAsync(\n      projectRoot,\n      iosDirectory,\n      exp.sdkVersion,\n      experienceUrl,\n      exp,\n      sdkVersionConfig.iosExpoViewUrl\n    );\n    exp.detach.iosExpoViewUrl = sdkVersionConfig.iosExpoViewUrl;\n  }\n\n  // Android\n  if (!hasAndroidDirectory) {\n    let androidDirectory = path.join(expoDirectory, 'android');\n    rimraf.sync(androidDirectory);\n    mkdirp.sync(androidDirectory);\n    await detachAndroidAsync(\n      projectRoot,\n      androidDirectory,\n      exp.sdkVersion,\n      experienceUrl,\n      exp,\n      sdkVersionConfig.androidExpoViewUrl\n    );\n    exp.detach.androidExpoViewUrl = sdkVersionConfig.androidExpoViewUrl;\n  }\n\n  console.log('Writing ExpoKit configuration...');\n  // Update exp.json/app.json\n  // if we're writing to app.json, we need to place the configuration under the expo key\n  const nameToWrite = await ProjectUtils.configFilenameAsync(projectRoot);\n  if (nameToWrite === 'app.json') {\n    exp = { expo: exp };\n  }\n  await fs.promise.writeFile(\n    path.join(projectRoot, nameToWrite),\n    JSON.stringify(exp, null, 2)\n  );\n\n  console.log(\n    'Finished detaching your project! Look in the `android` and `ios` directories for the respective native projects.'\n  );\n  return true;\n}\n\nfunction getIosPaths(projectRoot, manifest) {\n  let iosProjectDirectory = path.join(projectRoot, 'ios');\n  let projectNameLabel = manifest.name;\n  let projectName = projectNameLabel\n    .replace(/[^a-z0-9_\\-]/gi, '-')\n    .toLowerCase();\n  return {\n    iosProjectDirectory,\n    projectName,\n  };\n}\n\n/**\n *  Delete xcodeproj|xcworkspace under searchPath.\n *  Needed because extraneous xcode files will interfere with `react-native link`.\n */\nasync function cleanXCodeProjectsAsync(searchPath) {\n  let xcodeFilesToDelete = await glob.promise(\n    searchPath + '/**/*.@(xcodeproj|xcworkspace)'\n  );\n  if (xcodeFilesToDelete) {\n    for (let ii = 0; ii < xcodeFilesToDelete.length; ii++) {\n      let toRemove = xcodeFilesToDelete[ii];\n      if (fs.existsSync(toRemove)) {\n        // needed because we may have recursively removed in past iteration\n        if (_isDirectory(toRemove)) {\n          rimraf.sync(toRemove);\n        } else {\n          await fs.promise.unlink(toRemove);\n        }\n      }\n    }\n  }\n  return;\n}\n\nasync function cleanVersionedReactNativeAsync(searchPath) {\n  // TODO: make it possible to allow a version for the kernel\n  let versionsToDelete = await glob.promise(searchPath + '/ABI*');\n  if (versionsToDelete) {\n    for (let ii = 0; ii < versionsToDelete.length; ii++) {\n      let toRemove = versionsToDelete[ii];\n      if (_isDirectory(toRemove)) {\n        rimraf.sync(toRemove);\n      }\n    }\n  }\n  return;\n}\n\nasync function configureDetachedVersionsPlistAsync(\n  configFilePath,\n  detachedSDKVersion,\n  kernelSDKVersion\n) {\n  await modifyIOSPropertyListAsync(\n    configFilePath,\n    'EXSDKVersions',\n    versionConfig => {\n      versionConfig.sdkVersions = [detachedSDKVersion];\n      versionConfig.detachedNativeVersions = {\n        shell: detachedSDKVersion,\n        kernel: kernelSDKVersion,\n      };\n      return versionConfig;\n    }\n  );\n}\n\nasync function configureDetachedIOSInfoPlistAsync(configFilePath, manifest) {\n  let result = await modifyIOSPropertyListAsync(\n    configFilePath,\n    'Info',\n    config => {\n      // add detached scheme\n      if (manifest.isDetached && manifest.detach.scheme) {\n        if (!config.CFBundleURLTypes) {\n          config.CFBundleURLTypes = [\n            {\n              CFBundleURLSchemes: [],\n            },\n          ];\n        }\n        config.CFBundleURLTypes[0].CFBundleURLSchemes.push(\n          manifest.detach.scheme\n        );\n      }\n      if (config.UIDeviceFamily) {\n        delete config.UIDeviceFamily;\n      }\n      return config;\n    }\n  );\n  return result;\n}\n\nasync function cleanPropertyListBackupsAsync(configFilePath) {\n  await cleanIOSPropertyListBackupAsync(configFilePath, 'EXShell', false);\n  await cleanIOSPropertyListBackupAsync(configFilePath, 'Info', false);\n  await cleanIOSPropertyListBackupAsync(configFilePath, 'EXSDKVersions', false);\n}\n\n/**\n *  Create a detached Expo iOS app pointing at the given project.\n */\nexport async function detachIOSAsync(\n  projectRoot: string,\n  expoDirectory: string,\n  sdkVersion: string,\n  experienceUrl: string,\n  manifest: any,\n  expoViewUrl: string\n) {\n  let { iosProjectDirectory, projectName } = getIosPaths(projectRoot, manifest);\n\n  let tmpExpoDirectory;\n  if (process.env.EXPO_VIEW_DIR) {\n    // Only for testing\n    tmpExpoDirectory = process.env.EXPO_VIEW_DIR;\n  } else {\n    tmpExpoDirectory = path.join(projectRoot, 'temp-ios-directory');\n    mkdirp.sync(tmpExpoDirectory);\n    console.log('Downloading iOS code...');\n    await Api.downloadAsync(expoViewUrl, tmpExpoDirectory, { extract: true });\n  }\n\n  console.log('Moving iOS project files...');\n  // HEY: if you need other paths into the extracted archive, be sure and include them\n  // when the archive is generated in `ios/pipeline.js`\n  await Utils.ncpAsync(\n    path.join(tmpExpoDirectory, 'ios'),\n    `${expoDirectory}/ios`\n  );\n  await Utils.ncpAsync(\n    path.join(tmpExpoDirectory, 'cpp'),\n    `${expoDirectory}/cpp`\n  );\n  await Utils.ncpAsync(\n    path.join(tmpExpoDirectory, 'exponent-view-template', 'ios'),\n    iosProjectDirectory\n  );\n  // make sure generated stub exists\n  let generatedExpoDir = path.join(\n    expoDirectory,\n    'ios',\n    'Exponent',\n    'Generated'\n  );\n  mkdirp.sync(generatedExpoDir);\n  fs.closeSync(fs.openSync(path.join(generatedExpoDir, 'EXKeys.h'), 'w'));\n\n  console.log('Naming iOS project...');\n  await spawnAsyncThrowError('sed', [\n    '-i',\n    `''`,\n    '--',\n    `s/exponent-view-template/${projectName}/g`,\n    `${iosProjectDirectory}/exponent-view-template.xcodeproj/project.pbxproj`,\n  ]);\n  await spawnAsyncThrowError('sed', [\n    '-i',\n    `''`,\n    '--',\n    `s/exponent-view-template/${projectName}/g`,\n    `${iosProjectDirectory}/exponent-view-template.xcworkspace/contents.xcworkspacedata`,\n  ]);\n  await spawnAsyncThrowError('sed', [\n    '-i',\n    `''`,\n    `s/exponent-view-template/${projectName}/g`,\n    `${iosProjectDirectory}/exponent-view-template.xcodeproj/xcshareddata/xcschemes/exponent-view-template.xcscheme`,\n  ]);\n  await spawnAsync('/bin/mv', [\n    `${iosProjectDirectory}/exponent-view-template`,\n    `${iosProjectDirectory}/${projectName}`,\n  ]);\n  await spawnAsync('/bin/mv', [\n    `${iosProjectDirectory}/exponent-view-template.xcodeproj/xcshareddata/xcschemes/exponent-view-template.xcscheme`,\n    `${iosProjectDirectory}/exponent-view-template.xcodeproj/xcshareddata/xcschemes/${projectName}.xcscheme`,\n  ]);\n  await spawnAsync('/bin/mv', [\n    `${iosProjectDirectory}/exponent-view-template.xcodeproj`,\n    `${iosProjectDirectory}/${projectName}.xcodeproj`,\n  ]);\n  await spawnAsync('/bin/mv', [\n    `${iosProjectDirectory}/exponent-view-template.xcworkspace`,\n    `${iosProjectDirectory}/${projectName}.xcworkspace`,\n  ]);\n\n  console.log('Configuring iOS project...');\n  let infoPlistPath = `${iosProjectDirectory}/${projectName}/Supporting`;\n  let iconPath = `${iosProjectDirectory}/${projectName}/Assets.xcassets/AppIcon.appiconset`;\n  await configureStandaloneIOSInfoPlistAsync(infoPlistPath, manifest);\n  let infoPlist = await configureDetachedIOSInfoPlistAsync(\n    infoPlistPath,\n    manifest\n  );\n  await configureStandaloneIOSShellPlistAsync(\n    infoPlistPath,\n    manifest,\n    experienceUrl\n  );\n  // TODO: logic for when kernel sdk version is different from detached sdk version\n  await configureDetachedVersionsPlistAsync(\n    infoPlistPath,\n    sdkVersion,\n    sdkVersion\n  );\n  await configureIOSIconsAsync(manifest, iconPath, projectRoot);\n  // we don't pre-cache JS in this case, TODO: think about whether that's correct\n\n  console.log('Configuring iOS dependencies...');\n  let podName = sdkVersion === '14.0.0' ? 'ExponentView' : 'ExpoKit';\n  await renderExponentViewPodspecAsync(\n    path.join(tmpExpoDirectory, 'template-files', 'ios', `${podName}.podspec`),\n    path.join(expoDirectory, `${podName}.podspec`),\n    { IOS_EXPONENT_CLIENT_VERSION: infoPlist.EXClientVersion }\n  );\n  await renderPodfileAsync(\n    path.join(tmpExpoDirectory, 'template-files', 'ios', `${podName}-Podfile`),\n    path.join(iosProjectDirectory, 'Podfile'),\n    {\n      TARGET_NAME: projectName,\n      EXPONENT_ROOT_PATH: path.relative(iosProjectDirectory, expoDirectory),\n      REACT_NATIVE_PATH: path.relative(\n        iosProjectDirectory,\n        path.join(projectRoot, 'node_modules', 'react-native')\n      ),\n    },\n    sdkVersion\n  );\n\n  console.log('Cleaning up iOS...');\n  await cleanPropertyListBackupsAsync(infoPlistPath);\n  await cleanVersionedReactNativeAsync(\n    path.join(expoDirectory, 'ios', 'versioned-react-native')\n  );\n  await cleanXCodeProjectsAsync(path.join(expoDirectory, 'ios'));\n\n  if (!process.env.EXPO_VIEW_DIR) {\n    rimraf.sync(tmpExpoDirectory);\n  }\n\n  // These files cause @providesModule naming collisions\n  if (process.platform === 'darwin') {\n    let rnFilesToDelete = await glob.promise(\n      path.join(expoDirectory, 'ios') + '/**/*.@(js|json)'\n    );\n    if (rnFilesToDelete) {\n      for (let i = 0; i < rnFilesToDelete.length; i++) {\n        await fs.promise.unlink(rnFilesToDelete[i]);\n      }\n    }\n  }\n\n  const podsInstructions = sdkVersion === '14.0.0'\n    ? '`cd ios && ./pod-install-exponent.sh`'\n    : '`cd ios && pod install`';\n  console.log(\n    `iOS detach is complete! To configure iOS native dependencies, make sure you have the Cocoapods gem, then ${podsInstructions}\\n`\n  );\n  return;\n}\n\nasync function regexFileAsync(filename, regex, replace) {\n  let file = await fs.promise.readFile(filename);\n  let fileString = file.toString();\n  await fs.promise.writeFile(filename, fileString.replace(regex, replace));\n}\n\nasync function renamePackageAsync(directory, originalPkg, destPkg) {\n  let originalSplitPackage = originalPkg.split('.');\n  let originalDeepDirectory = directory;\n  for (let i = 0; i < originalSplitPackage.length; i++) {\n    originalDeepDirectory = path.join(\n      originalDeepDirectory,\n      originalSplitPackage[i]\n    );\n  }\n\n  // copy files into temp directory\n  let tmpDirectory = path.join(directory, 'tmp-exponent-directory');\n  mkdirp.sync(tmpDirectory);\n  await Utils.ncpAsync(originalDeepDirectory, tmpDirectory);\n\n  // delete old package\n  rimraf.sync(path.join(directory, originalSplitPackage[0]));\n\n  // make new package\n  let newSplitPackage = destPkg.split('.');\n  let newDeepDirectory = directory;\n  for (let i = 0; i < newSplitPackage.length; i++) {\n    newDeepDirectory = path.join(newDeepDirectory, newSplitPackage[i]);\n    mkdirp.sync(newDeepDirectory);\n  }\n\n  // copy from temp to new package\n  await Utils.ncpAsync(tmpDirectory, newDeepDirectory);\n\n  // delete temp\n  rimraf.sync(tmpDirectory);\n}\n\nasync function detachAndroidAsync(\n  projectRoot,\n  expoDirectory,\n  sdkVersion,\n  experienceUrl,\n  manifest,\n  expoViewUrl: string\n) {\n  let tmpExpoDirectory;\n  if (process.env.EXPO_VIEW_DIR) {\n    // Only for testing\n    tmpExpoDirectory = process.env.EXPO_VIEW_DIR;\n  } else {\n    tmpExpoDirectory = path.join(projectRoot, 'temp-android-directory');\n    mkdirp.sync(tmpExpoDirectory);\n    console.log('Downloading Android code...');\n    await Api.downloadAsync(expoViewUrl, tmpExpoDirectory, { extract: true });\n  }\n\n  let androidProjectDirectory = path.join(projectRoot, 'android');\n\n  console.log('Moving Android project files...');\n\n  await Utils.ncpAsync(\n    path.join(tmpExpoDirectory, 'android', 'maven'),\n    path.join(expoDirectory, 'maven')\n  );\n  await Utils.ncpAsync(\n    path.join(tmpExpoDirectory, 'android', 'detach-scripts'),\n    path.join(expoDirectory, 'detach-scripts')\n  );\n  await Utils.ncpAsync(\n    path.join(tmpExpoDirectory, 'exponent-view-template', 'android'),\n    androidProjectDirectory\n  );\n  if (process.env.EXPO_VIEW_DIR) {\n    rimraf.sync(path.join(androidProjectDirectory, 'build'));\n    rimraf.sync(path.join(androidProjectDirectory, 'app', 'build'));\n  }\n\n  // Fix up app/build.gradle\n  console.log('Configuring Android project...');\n  let appBuildGradle = path.join(\n    androidProjectDirectory,\n    'app',\n    'build.gradle'\n  );\n  await regexFileAsync(appBuildGradle, /\\/\\* UNCOMMENT WHEN DISTRIBUTING/g, '');\n  await regexFileAsync(\n    appBuildGradle,\n    /END UNCOMMENT WHEN DISTRIBUTING \\*\\//g,\n    ''\n  );\n  await regexFileAsync(appBuildGradle, `compile project(':expoview')`, '');\n\n  // Fix AndroidManifest\n  let androidManifest = path.join(\n    androidProjectDirectory,\n    'app',\n    'src',\n    'main',\n    'AndroidManifest.xml'\n  );\n  await regexFileAsync(\n    androidManifest,\n    'PLACEHOLDER_DETACH_SCHEME',\n    manifest.detach.scheme\n  );\n\n  // Fix MainActivity\n  let mainActivity = path.join(\n    androidProjectDirectory,\n    'app',\n    'src',\n    'main',\n    'java',\n    'detach',\n    'app',\n    'template',\n    'pkg',\n    'name',\n    'MainActivity.java'\n  );\n  await regexFileAsync(mainActivity, 'TEMPLATE_INITIAL_URL', experienceUrl);\n\n  // Fix package name\n  let packageName = manifest.android.package;\n  await renamePackageAsync(\n    path.join(androidProjectDirectory, 'app', 'src', 'main', 'java'),\n    ANDROID_TEMPLATE_PKG,\n    packageName\n  );\n  await renamePackageAsync(\n    path.join(androidProjectDirectory, 'app', 'src', 'test', 'java'),\n    ANDROID_TEMPLATE_PKG,\n    packageName\n  );\n  await renamePackageAsync(\n    path.join(androidProjectDirectory, 'app', 'src', 'androidTest', 'java'),\n    ANDROID_TEMPLATE_PKG,\n    packageName\n  );\n\n  let packageNameMatches = await glob.promise(\n    androidProjectDirectory + '/**/*.@(java|gradle|xml)'\n  );\n  if (packageNameMatches) {\n    let oldPkgRegex = new RegExp(\n      `${ANDROID_TEMPLATE_PKG.replace(/\\./g, '\\\\\\.')}`,\n      'g'\n    );\n    for (let i = 0; i < packageNameMatches.length; i++) {\n      await regexFileAsync(packageNameMatches[i], oldPkgRegex, packageName);\n    }\n  }\n\n  // Fix app name\n  console.log('Naming Android project...');\n  let appName = manifest.name;\n  await regexFileAsync(\n    path.resolve(\n      androidProjectDirectory,\n      'app',\n      'src',\n      'main',\n      'res',\n      'values',\n      'strings.xml'\n    ),\n    ANDROID_TEMPLATE_NAME,\n    appName\n  );\n\n  // Fix image\n  let icon = manifest.icon;\n  if (icon) {\n    let iconMatches = await glob.promise(\n      path.join(androidProjectDirectory, 'app', 'src', 'main', 'res') +\n        '/**/ic_launcher.png'\n    );\n    if (iconMatches) {\n      for (let i = 0; i < iconMatches.length; i++) {\n        await fs.promise.unlink(iconMatches[i]);\n        // TODO: make more efficient\n        await saveIconToPathAsync(projectRoot, icon, iconMatches[i]);\n      }\n    }\n  }\n\n  // Clean up\n  console.log('Cleaning up Android...');\n  if (!process.env.EXPO_VIEW_DIR) {\n    rimraf.sync(tmpExpoDirectory);\n  }\n  console.log('Android detach is complete!\\n');\n}\n\nexport async function prepareDetachedBuildAsync(projectDir: string, args: any) {\n  let { exp } = await ProjectUtils.readConfigJsonAsync(projectDir);\n\n  if (args.platform === 'ios') {\n    let { iosProjectDirectory, projectName } = getIosPaths(projectDir, exp);\n\n    console.log(`Preparing iOS build at ${iosProjectDirectory}...`);\n    // These files cause @providesModule naming collisions\n    // but are not available until after `pod install` has run.\n    let podsDirectory = path.join(iosProjectDirectory, 'Pods');\n    if (!_isDirectory(podsDirectory)) {\n      throw new Error(\n        `Can't find directory ${podsDirectory}, make sure you've run pod install.`\n      );\n    }\n    let rnPodDirectory = path.join(podsDirectory, 'React');\n    if (_isDirectory(rnPodDirectory)) {\n      let rnFilesToDelete = await glob.promise(\n        rnPodDirectory + '/**/*.@(js|json)'\n      );\n      if (rnFilesToDelete) {\n        for (let i = 0; i < rnFilesToDelete.length; i++) {\n          await fs.promise.unlink(rnFilesToDelete[i]);\n        }\n      }\n    }\n    // insert expo development url into iOS config\n    if (!args.skipXcodeConfig) {\n      let devUrl = await UrlUtils.constructManifestUrlAsync(projectDir);\n      let configFilePath = path.join(\n        iosProjectDirectory,\n        projectName,\n        'Supporting'\n      );\n      await modifyIOSPropertyListAsync(\n        configFilePath,\n        'EXShell',\n        shellConfig => {\n          shellConfig.developmentUrl = devUrl;\n          return shellConfig;\n        }\n      );\n    }\n  } else {\n    let androidProjectDirectory = path.join(projectDir, 'android');\n    let expoBuildConstantsMatches = await glob.promise(\n      androidProjectDirectory + '/**/ExponentBuildConstants.java'\n    );\n    if (expoBuildConstantsMatches && expoBuildConstantsMatches.length) {\n      let expoBuildConstants = expoBuildConstantsMatches[0];\n      let devUrl = await UrlUtils.constructManifestUrlAsync(projectDir);\n      await regexFileAsync(\n        expoBuildConstants,\n        /DEVELOPMENT_URL \\= \\\"[^\\\"]*\\\"\\;/,\n        `DEVELOPMENT_URL = \"${devUrl}\";`\n      );\n    }\n  }\n}\n"],"sourceRoot":"/xdl/src"}